{% extends "base.html" %}
{% block content %}

<div class="card-premium mx-auto text-center">
    <h2>Processing Your Report...</h2>
    <p class="mt-3">This may take 10–30 seconds depending on market data and AI generation.</p>

    <div class="spinner" style="margin-top:25px;"></div>
    <p id="statusText" class="mt-4">Gathering financial data…</p>
</div>

<script>
function checkStatus() {
    fetch("/job_status/{{ job_id }}")
        .then(response => response.json())
        .then(data => {
            if (data.status === "done") {
                window.location.href = "/ready/{{ job_id }}";
            } else if (data.status === "error") {
                document.getElementById("statusText").innerHTML =
                    "❌ Error generating report:<br>" + (data.error || "Unknown error");
            } else {
                document.getElementById("statusText").innerText =
                    "Report is running (" + data.status + ")…";
                setTimeout(checkStatus, 2000);
            }
        })
        .catch(err => {
            document.getElementById("statusText").innerText =
                "Network error while checking job status.";
        });
}
setTimeout(checkStatus, 1500);
</script>

{% endblock %}

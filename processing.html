{% extends "base.html" %}
{% block content %}

<div class="card-premium mx-auto text-center">

    <h2 style="color:#09ffc9;">Processing Your Report...</h2>
    <p class="mt-3">This may take 10–20 seconds depending on market data and AI generation.</p>

    <div class="spinner" style="margin-top:25px;"></div>

    <p id="statusText" class="mt-4">Gathering financial data…</p>

</div>

<script>
function checkStatus() {
    fetch("/job_status/{{ job_id }}")
        .then(response => response.json())
        .then(data => {
            if (data.status === "done") {
                // Redirect to READY page instead of auto-download
                window.location.href = "/ready/{{ job_id }}";
            }
            else if (data.status === "error") {
                document.getElementById("statusText").innerHTML =
                    "❌ Error generating report:<br>" + data.error;
            }
            else {
                document.getElementById("statusText").innerText =
                    "Report is running (" + data.status + ")…";

                setTimeout(checkStatus, 2000);
            }
        })
        .catch(err => {
            document.getElementById("statusText").innerText =
                "Network error while checking job status.";
        });
}

setTimeout(checkStatus, 1500);
</script>

<style>
.spinner {
  border: 6px solid #333;
  border-top: 6px solid #09ffc9;
  border-radius: 50%;
  width: 48px;
  height: 48px;
  margin: auto;
  animation: spin 0.8s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
</style>

{% endblock %}
